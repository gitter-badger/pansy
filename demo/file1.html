<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Plugin</title>
  <script src="../dist/pansy.js"></script>
  <script src="./jquery/2.1.4/jquery.min.js"></script>
</head>
<body>

<div id="container"></div>

<script type="text/template" id="chatMain">

  <div id="chat">

  </div>

</script>


<script type="text/template" id="chatChat">

  <div>
    <a href="#/chat/friends">返回列表</a>

  </div>

</script>


<script type="text/template" id="chatWelcome">

  <a href="#/chat/friends">开始聊天</a>

</script>

<script type="text/template" id="chatFriends">

  <div>

    <ul>
      <li><a href="#/chat/chat">聊天</a></li>
      <li><a href="#/chat/chat">聊天</a></li>
      <li><a href="#/chat/chat">聊天</a></li>
      <li><a href="#/chat/chat">聊天</a></li>
      <li><a href="#/chat/chat">聊天</a></li>
      <li><a href="#/chat/chat">聊天</a></li>
    </ul>

  </div>

</script>

<script>

  var controller = {}
  controller.chatRenderLayout = function(req, res, next){
    if($('#chat').length) return next()
    $('body').append($('#chatMain').html())
    next()
  }

  controller.chatRenderFriends = function(req, res, next){
    $('#chat').html($("#chatFriends").html())
    res.end()
  }

  controller.chatRenderChat = function(req, res, next){
    $('#chat').html($("#chatChat").html())
    res.end()
  }

  controller.welcome = function(req, res, next){
    $("#chat").html($("#chatWelcome").html())
    res.end()
  }

  var chat = pansy.createPlugin({
    pluginName: 'chat'
  })

  chat.route('/friends').get(
          controller.chatRenderLayout,
          controller.chatRenderFriends)
  chat.route('/chat').get(
          controller.chatRenderLayout,
          controller.chatRenderChat)
  chat.route('/').get(
          controller.chatRenderLayout,
          controller.welcome)

  chat.use(function(req, res){

    $('body').html('404 not found')
    res.end()
  })

  chat.go(location.hash)

</script>


</body>
</html>