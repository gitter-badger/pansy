/*! PURPLE.js v0.7.0-alpha 2015-10-20 */
!function(a){function b(){function a(a,b,c){return"undefined"!=typeof this.disabled?c():(this.disabled=!0,l.conf.spa?(document.addEventListener("click",function(a){function b(a,c){a==document.body||null==a?c("notfound"):"A"==a.nodeName?"undefined"==typeof a.attributes.href?c("err"):c(null,a.attributes.href.value):b(a.parentNode,c)}b(a.target,function(b,c){return b?!1:void("#"==c.substr(0,1)||(a.preventDefault(),l.app.go(c,"push")))})},!1),void c()):c())}function b(a,b,c){return"undefined"!=typeof this.disabled?c():(this.disabled=!0,l.conf.spa?(window.addEventListener("popstate",function(a){var b=l.state.curUrl,c=location.href,e=d(b),f=d(c);e.pathname==f.pathname&&e.search==f.search||l.app.go(location.href)},!1),void c()):c())}function c(a){try{return 4==a.toString().match(/[A-Z0-9a-z,(\s]*\)/)[0].split(",").length}catch(b){return!1}}function d(a){function b(a){if("undefined"!=typeof a.origin)return a.origin;var b=a.protocol+"//"+a.hostname;return""==a.port?b:"80"==a.port&&"http:"==a.protocol?b:"443"==a.port&&"https"==a.protocol?b:b+=":"+a.port}var c=document.createElement("a");c.href=a;var d=c.pathname||"/"+c.pathname,e={rawUrl:c.href,href:c.href,origin:b(c),source:a,protocol:c.protocol.replace(":",""),hostname:c.hostname,port:c.port,relative:(c.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],pathname:d.replace(/^([^\/])/,"/$1"),pathnames:j(c.pathname.replace(/^\//,"").split("/"),""),search:c.search,query:function(){for(var a,b={},d=c.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),b[a[0]]=a[1]);return b}(),hash:c.hash.replace("#",""),hashes:j(c.hash.replace(/^(#)*/i,"").replace(/^\//,"").split("/"),""),file:(c.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1]},f="/"+e.pathnames.join("/");if(!g(e.searches)){f+=String("?");for(var h in e.searches)e.searches.hasOwnProperty(h)&&(f+=h+"=",f+="undefined"!=typeof e.searches[h]?e.searches[h]:"",f+="&");f=f.substring(0,f.length-1)}if(e.hashes.length>0){f+="#";for(var i=0;i<e.hashes.length;i++)f+=i<e.hashes.length-1?e.hashes[i]+String("/"):e.hashes[i]}return e.params=e.pathnames,e.parsedURL=f,e.parsedUrl=f,e}function e(a,b){try{return a.filterPath.match(b)[0]==a.filterPath}catch(c){return!1}}function f(a,b){var c=a.length;if("function"!=typeof b)throw new TypeError;for(var d=0;c>d;d++)d in a&&b.call(arguments[1],a[d],d,a)}function g(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function h(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&"function"==typeof b&&(c[d]=b.call(a,a[d],d,a));return c}function i(){var a={},b=Array.prototype.slice.call(arguments,0);return f(b,function(b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}function j(a,b){var c=[];return f(a,function(a){a!==b&&c.push(a)}),c}function k(){return l.init?l.app:(l.conf={origin:location.origin||location.protocol+"//"+location.hostname+(""==location.port?"":":"+location.port),timeout:6e4,routeByQuery:!1,routeQuery:"route",routeScope:"",spa:!1},l.state={complete:!0,prevUrl:null,curUrl:location.href,errorStack:null},l.stack=[],l.app={},l.app.set=function(a,b){l.conf[a]=b},l.app.get=function(a){return"undefined"!=typeof a?l.conf[a]:l.conf},l.app.use=function(){if(1==arguments.length)if("function"==typeof arguments[0]){var a={fn:arguments[0]};a.isErrorHandle=c(a.fn),l.stack.push(a)}else if(arguments[0]instanceof Array){var b=arguments[0];h(b,function(a,b){"function"==typeof a?l.app.use(a):a instanceof Array&&2==a.length&&l.app.use(a[0],a[1])})}else arguments[0]instanceof Object&&arguments[0].__stack instanceof Array&&l.app.use(arguments[0].__stack);else if(2==arguments.length){var d=arguments[0],a={fn:arguments[1]};d instanceof Array?d=new RegExp("(^"+d.join("$)|(^")+"$)"):"string"==typeof d&&(d=new RegExp("^"+d+"$")),!d instanceof RegExp,a.path=d,a.isErrorHandle=c(a.fn),l.stack.push(a)}},l.app.go=function(a,b){if(!l.state.complete)return!1;l.state.complete=!1;var c=d(a);if(c.origin!=l.conf.origin&&location.replace(a),l.conf.routeByQuery)var f=c.query[l.conf.routeQuery]||"/";else if(c.pathname.match(new RegExp("^"+l.conf.routeScope)))var f=c.pathname.substr(l.conf.routeScope.length)||"/";else var f="/";var g=setTimeout(function(){j.end()},l.conf.timeout),h=i(c,{routed:!1,expire:Date.now()+l.conf.timeout,conf:l.conf,state:l.state,filterPath:f,rawUrl:a,historyStateType:b||"push"}),j={end:function(){l.state.complete=!0,l.state.errorStack=null,clearTimeout(g),l.conf.spa&&("replace"==h.historyStateType?history.replaceState("data","title",h.parsedURL):history.pushState("data","title",h.parsedURL))},redirect:function(a){this.end(),l.app.go(a,"replace")}},k=-1,m=function(a){function b(){l.stack[k].isErrorHandle?l.stack[k].fn(l.state.errorStack,h,j,m):l.stack[k].fn(h,j,m)}k++,"undefined"!=typeof a&&(l.state.errorStack||(l.state.errorStack=[]),l.state.errorStack.push(a)),k>=l.stack.length?(l.state.errorStack,!h.routed,j.end()):"undefined"!=typeof l.stack[k].disabled?m():"undefined"!=typeof l.stack[k].path?e(h,l.stack[k].path)?(h.routed=!0,b()):m():b()};m()},l.app.use(b),l.app.use(a),l.init=!0,l.app)}var l={init:!1};return k.Router=function(){var a=[];return{__stack:a,use:function(b){a.push(b)},route:function(b){return{get:function(){var c=Array.prototype.slice.call(arguments,0);h(c,function(c,d){a.push([b,c])})}}}}},k.Controller=function(){var a={};return function(b,c){var d="undefined"!=typeof a[b];return"function"==typeof c?a[b]=c:d||(a[b]=function(a,b,c){c()}),a[b]}},k}"function"==typeof define&&define.amd?define(function(){return b()}):a.purple=b()}(this);