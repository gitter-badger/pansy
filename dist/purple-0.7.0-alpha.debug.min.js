/*! PURPLE.js (DEBUG) v0.7.0-alpha 2015-10-17 */
!function(a){function b(){function a(a){try{return 4==a.toString().match(/[a-z,(\s]*\)/)[0].split(",").length}catch(b){return!1}}function b(a){var b=document.createElement("a");b.href=a;var c=b.pathname||"/"+b.pathname,d={rawUrl:b.href,href:b.href,origin:b.origin,source:a,protocol:b.protocol.replace(":",""),hostname:b.hostname,port:b.port,relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],pathname:c.replace(/^([^\/])/,"/$1"),pathnames:h(b.pathname.replace(/^\//,"").split("/"),""),search:b.search,query:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}(),hash:b.hash.replace("#",""),hashes:h(b.hash.replace(/^(#)*/i,"").replace(/^\//,"").split("/"),""),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1]},f="/"+d.pathnames.join("/");if(!e(d.searches)){f+=String("?");for(var g in d.searches)d.searches.hasOwnProperty(g)&&(f+=g+"=",f+="undefined"!=typeof d.searches[g]?d.searches[g]:"",f+="&");f=f.substring(0,f.length-1)}if(d.hashes.length>0){f+="#";for(var i=0;i<d.hashes.length;i++)f+=i<d.hashes.length-1?d.hashes[i]+String("/"):d.hashes[i]}return d.params=d.pathnames,d.parsedURL=f,d.parsedUrl=f,d}function c(a,b){}function d(a,b){var c=a.length;if("function"!=typeof b)throw new TypeError;for(var d=0;c>d;d++)d in a&&b.call(arguments[1],a[d],d,a)}function e(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function f(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&"function"==typeof b&&(c[d]=b.call(a,a[d],d,a));return c}function g(){var a={},b=Array.prototype.slice.call(arguments,0);return d(b,function(b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}function h(a,b){var c=[];return d(a,function(a){a!==b&&c.push(a)}),c}function i(){return j.init?j.app:(j.conf={timeout:6e4,routeByQuery:!1,routeQuery:null,routeScope:""},j.state={spa:!1,complete:!0,prevUrl:null,curUrl:location.href,errorStack:null},j.stack=[],j.app={},j.app.set=function(a,b){j.conf[a]=b},j.app.get=function(a){return"undefined"!=typeof a?j.conf[a]:j.conf},j.app.use=function(){if(1==arguments.length)if("function"==typeof arguments[0]){var b=arguments[0];b.isErrorHandle=a(b),j.stack.push(b)}else if(arguments[0]instanceof Array){var c=arguments[0];f(c,function(a,b){"function"==typeof a?j.app.use(a):a instanceof Array&&2==a.length?j.app.use(a[0],a[1]):console.warn("use参数有误")})}else arguments[0]instanceof Object&&arguments[0].__stack instanceof Array?j.app.use(arguments[0].__stack):console.warn("use参数有误");else if(2==arguments.length){var d=arguments[0],b=arguments[1];d instanceof Array?d=new RegExp("(^"+d.join("$)|(^")+"$)"):"string"==typeof d&&(d=new RegExp("^"+d+"$")),!d instanceof RegExp&&console.error("route参数错误: "+d),b.path=d,b.isErrorHandle=a(b),j.stack.push(b)}},j.app.go=function(a,d){if(!j.state.complete)return!1;j.state.complete=!1;var e=g(b(a),{routed:!1,expire:Date.now()+j.conf.timeout,conf:j.conf,state:j.state,rawUrl:a,historyStateType:d||"push"}),f={end:function(){j.state.complete=!0,j.state.errorStack=null,console.log("路由跳转完毕。")},redirect:function(a){this.end(),j.app.go(a,"replace")}},h=-1,i=function(a){function b(){"undefined"!=typeof j.stack[h].isErrorHandle?j.stack[h](j.state.errorStack,e,f,i):j.stack[h](e,f,i)}h++,"undefined"!=typeof a&&(j.state.errorStack||(j.state.errorStack=[]),j.state.errorStack.push(a)),h>=j.stack.length?(j.state.errorStack&&console.error(j.state.errorStack),e.routed||console.error("404 not found"),f.end()):"undefined"!=typeof j.stack[h].disabled?i():"undefined"!=typeof j.stack[h].path?c(j.stack[h].path)?(e.routed=!0,b()):i():b()};i()},j.init=!0,j.app)}var j={init:!1};return i.Router=function(){var a=[];return{__stack:a,use:function(b){a.push(b)},route:function(b){return{get:function(){var c=Array.prototype.slice.call(arguments,0);f(c,function(c,d){a.push([b,c])})}}}}},i.Controller=function(){var a={};return function(b,c){var d="undefined"!=typeof a[b];return"function"==typeof c?(d&&console.warn("controller has exits, but this new controller will be registered: "+b),a[b]=c,a[b]):(d||(console.warn("controller lost fn param, but it still run: "+b),a[b]=function(a,b,c){c()}),a[b])}},i}"function"==typeof define&&define.amd?define(function(){return b()}):a.purple=b()}(this);