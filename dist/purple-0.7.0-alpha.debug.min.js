/*! PURPLE.js (DEBUG) v0.7.0-alpha 2015-10-14 */
!function(a){function b(){function a(a){var c=document.createElement("a");c.href=a;var e=c.pathname||"/"+c.pathname,f={rawUrl:c.href,href:c.href,origin:c.origin,source:a,protocol:c.protocol.replace(":",""),hostname:c.hostname,port:c.port,relative:(c.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],pathname:e.replace(/^([^\/])/,"/$1"),pathnames:d(c.pathname.replace(/^\//,"").split("/"),""),search:c.search,searches:function(){for(var a,b={},d=c.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),b[a[0]]=a[1]);return b}(),hash:c.hash.replace("#",""),hashes:d(c.hash.replace(/^(#)*/i,"").replace(/^\//,"").split("/"),""),file:(c.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1]},g="/"+f.pathnames.join("/");if(!b(f.searches)){g+=String("?");for(var h in f.searches)f.searches.hasOwnProperty(h)&&(g+=h+"=",g+="undefined"!=typeof f.searches[h]?f.searches[h]:"",g+="&");g=g.substring(0,g.length-1)}if(f.hashes.length>0){g+="#";for(var i=0;i<f.hashes.length;i++)g+=i<f.hashes.length-1?f.hashes[i]+String("/"):f.hashes[i]}return f.parsedURL=g,f.parsedUrl=g,f}function b(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function c(){var a={},b=Array.prototype.slice.call(arguments,0);return b.forEach(function(b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}function d(a,b){var c=[];return a.forEach(function(a){a!==b&&c.push(a)}),c}function e(){var b={__conf:{filter:{},timeout:45e3,routeByQuery:!1,routeQuery:null},__state:{spa:!1,complete:!0,prevUrl:null,curUrl:location.href},__stack:{},set:function(a,b){this.__conf[a]=b},use:function(a){var b=this;"function"==typeof a?b.__stack.push(a):a instanceof Array&&b.__stack.push(a)},go:function(b,d){if(!this.__state.complete)return!1;this.__state.complete=!1;var e=this,f=setTimeout(function(){console.warn("超时"),h.end()},e.conf.timeout),g=c(a(b),{prevUrl:e.__state.curUrl,rawUrl:b,historyStateType:d||"push"}),h={end:function(){clearTimeout(f),e.__state.complete=!0,console.log("路由跳转完毕。")},redirect:function(a){this.end(),e.go(a)}},i=function(a){"undefined"!=typeof a&&null!=a?e.conf.exceptionHandler(a,g,h,i):e.__state.complete||(flow.length>0?flow.shift()(g,h,i):h.end())};i()}};return b}return Array.prototype.forEach||(Array.prototype.forEach=function(a){var b=this.length;if("function"!=typeof a)throw new TypeError;for(var c=arguments[1],d=0;b>d;d++)d in this&&a.call(c,this[d],d,this)}),e.Router=function(){var a=[];return{__stack:a,use:function(b){a.push(b)},route:function(b){var c=b;return b instanceof Array?c=new RegExp("(^"+b.join("$)|(^")+"$)"):"string"==typeof b&&(c=new RegExp("^"+b+"$")),!b instanceof RegExp&&console.error("route参数错误: "+b),{get:function(){a.push({__stack:Array.prototype.slice.call(arguments,0),path:c})}}}}},e.Controller=function(){var a={};return function(b,c){var d="undefined"!=typeof a[b];return"function"==typeof c?(d&&console.warn("controller has exits, but this new controller will be registered: "+b),a[b]=c,a[b]):(d||(console.warn("controller lost fn param, but it still run: "+b),a[b]=function(a,b,c){c()}),a[b])}},e}"function"==typeof define&&define.amd?define(function(){return b()}):a.purple=b()}(this);