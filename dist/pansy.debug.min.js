/*! PURPLE.js (DEBUG) v0.7.2-alpha 2016-01-08 07:54:35 UTC
 * YOU CANNOT USE THIS FILE ON ANY OTHER PLATFORM.*/
!function(){function a(a){if(l.__mainAppInit){var b=l.__mainApp;b.state.spa&&g(b.state.curUrl).beforeHash()!=g(location.href).beforeHash()&&b.go(location.href,"replace")}}function b(a){function b(a){if(a!=document.body&&null!=a)if("A"==a.nodeName){if("undefined"!=typeof a.attributes.href){var e=a.attributes.href.value;c(e),d(e)}}else b(a.parentNode)}function c(b){"#"!=b.substr(0,1)&&(g(location.href).href==g(b).href?e(b):g(location.href).beforeHash()==g(b).beforeHash()?""==g(b).hash&&(a.preventDefault(),console.log("为了防止浏览器默认的刷新处理")):g(location.href).origin()==g(b).origin()&&e(b))}function d(a){var b=g(a).hash;if(""!=g(a).hash){var c=b.split("/");c.length>1&&"undefined"!=typeof l.__pluginApps[c[1]]&&l.__pluginApps[c[1]].go(a,"replace")}}function e(b){a.preventDefault(),console.info("开始解析:"+b),l.__mainApp.go(b,"push")}l.__mainAppInit?l.__mainApp.state.spa&&b(a.target):l.__hasPlugins&&b(a.target)}function c(a){var b={state:{isPlugin:!1,complete:!0,prevUrl:null,curUrl:location.href,timeout:6e4,mode:!1,routeQuery:null,routeScope:"",spa:!1,protocol:null},stack:[],set:function(a,b){var c=this;return"undefined"!=typeof b&&(c.state[a]=b),c.state[a].toString()||void 0},use:function(){var a=this;if(1==arguments.length)if("function"==typeof arguments[0]){var b={fn:arguments[0]};b.isErrorHandle=e(b.fn),a.stack.push(b)}else if(arguments[0]instanceof Array){var c=arguments[0];h(c,function(b,c){"function"==typeof b?a.use(b):b instanceof Array&&2==b.length?a.use(b[0],b[1]):(console.warn("use参数有误"),console.warn(b))})}else arguments[0]instanceof Object?arguments[0].__stack instanceof Array?a.use(arguments[0].__stack):console.warn("use router 时参数有误"):console.warn("use参数异常");else if(2==arguments.length){var d=arguments[0];d instanceof Array?d=new RegExp("(^"+d.join("$)|(^")+"$)"):"string"==typeof d&&(d=new RegExp("^"+d+"$")),!d instanceof RegExp&&console.error("route参数错误: "+d),a.stack.push({fn:arguments[1],path:d,isErrorHandel:e(arguments[1])})}},route:function(a){var b=this;return{get:function(){var c=Array.prototype.slice.call(arguments,0);h(c,function(c,d){b.use(a,c)})}}},go:function(a,b){function c(a){function b(){e.stack[p].isErrorHandle?e.stack[p].fn(o,l,m,c):e.stack[p].fn(l,m,c)}return n?console.error("Run next() after red.end(), PLS check."):(p++,"undefined"!=typeof a&&o.push(a),void(p>=e.stack.length?(o.length&&console.error(o),l.routed||console.error("404 not found"),m.end()):"undefined"!=typeof e.stack[p].disabled?c():"undefined"!=typeof e.stack[p].path?f(l,e.stack[p].path)?(l.routed=!0,b()):c():b()))}var e=this;if(!e.state.complete)return!1;e.state.complete=!1;var h=g(a||location.href).all(),i="/";e.state.isPlugin?a.length>0&&a.match(new RegExp("^#/"+e.state.pluginName))&&(i=a.substring(e.state.pluginName.length+2)||"/"):e.state.routeQuery?i=h.query[e.state.routeQuery]||"/":(h.pathname.match(new RegExp("^"+e.state.routeScope))&&(i=h.pathname.substr(e.state.routeScope.length)||"/"),h.params=k(i.replace(/^\//,"").split("/"),"")),h.filterPath=i,console.info("请求地址: "+h.filterPath);var l=j(h,{routed:!1,expire:(new Date).getTime()+e.state.timeout,conf:e.state,state:e.state,historyStateType:b||"push"}),m={end:function(){n=!0,e.state.complete=!0,e.state.errorStack=null,console.info("请求结束"),e.state.spa&&"file:"!=e.state.protocol&&(console.log("spa: "+e.state.spa),"replace"==l.historyStateType?history.replaceState("data","title",l.rawUrl):history.pushState("data","title",l.rawUrl))},redirect:function(a){m.end(),e.state.spa?d(a):location.href=a}},n=!1,o=[],p=-1;c()}};return b.state=j(b.state,a),b}function d(a){}function e(a){try{return 4==a.toString().match(/[A-Z0-9a-z,(\s]*\)/)[0].split(",").length}catch(b){return!1}}function f(a,b){try{return a.filterPath.match(b)[0]==a.filterPath}catch(c){return!1}}function g(a){function b(){return f.href.replace(/#.*/,"")}function c(){var a=f.pathname||"/"+f.pathname;return a.replace(/^([^\/])/,"/$1")}function d(){for(var a={},b=f.search.replace(/^\?/,"").split("&"),c=b.length,d=0;c>d;d++)if(b[d]){var e=b[d].split("=");a[e[0]]=e[1]}return a}function e(){if("undefined"!=typeof f.origin)return f.origin;var a=f.protocol+"//"+f.hostname;return""==f.port?a:"80"==f.port&&"http:"==f.protocol?a:"443"==f.port&&"https"==f.protocol?a:a+=":"+f.port}var f=document.createElement("a");return f.href=a,{rawUrl:f.href,href:f.href,hash:f.hash,port:f.port,protocol:f.protocol,pathname:c,query:d,origin:e,beforeHash:b,all:function(){return{port:f.port,protocol:f.protocol,hostname:f.hostname,pathname:c(),query:d(),origin:e()}}}}function h(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&"function"==typeof b&&(c[d]=b.call(a,a[d],d,a));return c}function i(a,b){var c=a.length;if("function"!=typeof b)throw new TypeError;for(var d=0;c>d;d++)d in a&&b.call(arguments[1],a[d],d,a)}function j(){var a={},b=Array.prototype.slice.call(arguments,0);return i(b,function(b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}function k(a,b){var c=[];return i(a,function(a){a!==b&&c.push(a)}),c}var l={__mainAppInit:!1,__hasPlugins:!1,__mainApp:{},__pluginApps:{},__onpopstate:!1,__onanchorclick:!1,createMain:function(a){return this.__mainAppInit?this.__mainApp:(l.__mainAppInit=!0,this.__mainApp=c(a))},createPlugin:function(a){return l.__hasPlugins=!0,"undefined"!=typeof this.__pluginApps[a.pluginName]?this.__pluginApps[a.pluginName]:(a.isPlugin=!0,this.__pluginApps[a.pluginName]=c(a),this.__pluginApps[a.pluginName])},Router:function(){var a=[];return{__stack:a,use:function(b){a.push(b)},route:function(b){return{get:function(){var c=Array.prototype.slice.call(arguments,0);h(c,function(c,d){a.push([b,c])})}}}}}};if(Date.now||(Date.now=function(){return(new Date).getTime()}),"undefined"!=typeof window.onpopstate&&window.addEventListener("popstate",a,!1),"undefined"!=typeof document.addEventListener?document.addEventListener("click",b,!1):"undefined"!=typeof document.attachEvent?document.attachEvent("onclick",b):document.onclick=b,"object"==typeof exports&&"undefined"!=typeof module)module.exports=l;else if("function"==typeof define&&define.amd)define(function(){return l});else{var m;m="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,m.pansy=l}}();