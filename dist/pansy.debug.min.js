/*! PURPLE.js (DEBUG) v0.7.2-alpha 2015-12-01 04:00:41 UTC
 * YOU CANNOT USE THIS FILE ON ANY OTHER PLATFORM.*/
function subscribe(a,b){a=a.push?a:[a];var c,d,e,f,g=[],h=a.length,i=h;for(c=function(a,c){c.length&&g.push(a),i-=1,0===i&&b(g)};h--;)d=a[h],e=bundleResultCache[d],e?c(d,e):(f=bundleCallbackQueue[d]=bundleCallbackQueue[d]||[],f.push(c))}function publish(a,b){if(a){var c=bundleCallbackQueue[a];if(bundleResultCache[a]=b,c)for(;c.length;)c[0](a,b),c.splice(0,1)}}function loadScript(a,b){var c=doc.createElement("script");c.style="text/javascript",c.async=!0,c.src=a,c.onload=c.onerror=function(d){c.parentNode.removeChild(c),c=null,b(a,d.type)},head.appendChild(c)}function loadScripts(a,b){a=a.push?a:[a];var c,d=a.length,e=d,f=[];for(c=function(a,c){"error"===c&&f.push(a),e-=1,0===e&&b(f)};d--;)loadScript(a[d],c)}function loadjs(a,b,c,d){var e,f,g;if(b&&!b.call&&(e=b),f=e?c:b,g=e?d:c,e){if(e in bundleIdCache)throw new Error("LoadJS: Bundle already defined");bundleIdCache[e]=!0}win.setTimeout(function(){loadScripts(a,function(a){a.length?(g||devnull)(a):(f||devnull)(),publish(e,a)})},0)}!function(){function a(a){var g={state:{isPlugin:!1,complete:!0,prevUrl:null,curUrl:location.href,timeout:6e4,mode:!1,routeQuery:null,routeScope:"",spa:!1,protocol:null},stack:[],set:function(a,b){return"undefined"!=typeof b&&(app.state[a]=b),app.state[a].toString()||void 0},use:function(){var a=this;if(1==arguments.length)if("function"==typeof arguments[0]){var b={fn:arguments[0]};b.isErrorHandle=c(b.fn),a.stack.push(b)}else if(arguments[0]instanceof Array){var d=arguments[0];f(d,function(b,c){"function"==typeof b?a.use(b):b instanceof Array&&2==b.length?a.use(b[0],b[1]):(console.warn("use参数有误"),console.warn(b))})}else arguments[0]instanceof Object?arguments[0].__stack instanceof Array?a.use(arguments[0].__stack):console.warn("use router 时参数有误"):console.warn("use参数异常");else if(2==arguments.length){var e=arguments[0];e instanceof Array?e=new RegExp("(^"+e.join("$)|(^")+"$)"):"string"==typeof e&&(e=new RegExp("^"+e+"$")),!e instanceof RegExp&&console.error("route参数错误: "+e),a.stack.push({fn:arguments[1],path:e,isErrorHandel:c(arguments[1])})}},route:function(a){var b=this;return{get:function(){var c=Array.prototype.slice.call(arguments,0);f(c,function(c,d){b.use(a,c)})}}},go:function(a,c){function f(a){function b(){g.stack[p].isErrorHandle?g.stack[p].fn(o,l,m,f):g.stack[p].fn(l,m,f)}return n?console.error("Run next() after red.end(), PLS check."):(p++,"undefined"!=typeof a&&o.push(a),void(p>=g.stack.length?(o.length&&console.error(o),l.routed||console.error("404 not found"),m.end()):"undefined"!=typeof g.stack[p].disabled?f():"undefined"!=typeof g.stack[p].path?d(l,g.stack[p].path)?(l.routed=!0,b()):f():b()))}var g=this;if(!g.state.complete)return!1;g.state.complete=!1;var j=e(a||location.href).all(),k="/";g.state.isPlugin?a.length>0&&a.match(new RegExp("^#/"+g.state.pluginName))&&(k=a.substring(g.state.pluginName.length+2)||"/"):g.state.routeQuery?k=j.query[g.state.routeQuery]||"/":(j.pathname.match(new RegExp("^"+g.state.routeScope))&&(k=j.pathname.substr(g.state.routeScope.length)||"/"),j.params=i(k.replace(/^\//,"").split("/"),"")),j.filterPath=k,console.info("请求地址: "+j.filterPath);var l=h(j,{routed:!1,expire:Date.now()+g.state.timeout,conf:g.state,state:g.state,historyStateType:c||"push"}),m={end:function(){n=!0,g.state.complete=!0,g.state.errorStack=null,console.info("请求结束"),g.state.spa&&"file:"!=g.state.protocol&&(console.log("spa: "+g.state.spa),"replace"==l.historyStateType?history.replaceState("data","title",l.rawUrl):history.pushState("data","title",l.rawUrl))},redirect:function(a){m.end(),g.state.spa?b(a):location.href=a}},n=!1,o=[],p=-1;f()}};return g.state=h(g.state,a),g}function b(a){}function c(a){try{return 4==a.toString().match(/[A-Z0-9a-z,(\s]*\)/)[0].split(",").length}catch(b){return!1}}function d(a,b){try{return a.filterPath.match(b)[0]==a.filterPath}catch(c){return!1}}function e(a){function b(){return f.href.replace(/#.*/,"")}function c(){var a=f.pathname||"/"+f.pathname;return a.replace(/^([^\/])/,"/$1")}function d(){for(var a={},b=f.search.replace(/^\?/,"").split("&"),c=b.length,d=0;c>d;d++)if(b[d]){var e=b[d].split("=");a[e[0]]=e[1]}return a}function e(){if("undefined"!=typeof f.origin)return f.origin;var a=f.protocol+"//"+f.hostname;return""==f.port?a:"80"==f.port&&"http:"==f.protocol?a:"443"==f.port&&"https"==f.protocol?a:a+=":"+f.port}var f=document.createElement("a");return f.href=a,{rawUrl:f.href,href:f.href,hash:f.hash,port:f.port,protocol:f.protocol,pathname:c,query:d,origin:e,beforeHash:b,all:function(){return{port:f.port,protocol:f.protocol,hostname:f.hostname,pathname:c(),query:d(),origin:e()}}}}function f(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&"function"==typeof b&&(c[d]=b.call(a,a[d],d,a));return c}function g(a,b){var c=a.length;if("function"!=typeof b)throw new TypeError;for(var d=0;c>d;d++)d in a&&b.call(arguments[1],a[d],d,a)}function h(){var a={},b=Array.prototype.slice.call(arguments,0);return g(b,function(b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}function i(a,b){var c=[];return g(a,function(a){a!==b&&c.push(a)}),c}var j={__mainAppInit:!1,__hasPlugins:!1,__mainApp:{},__pluginApps:{},__onpopstate:!1,__onanchorclick:!1,createMain:function(b){return this.__mainAppInit?this.__mainApp:(j.__mainAppInit=!0,this.__mainApp=a(b))},createPlugin:function(b){return j.__hasPlugins=!0,"undefined"!=typeof this.__pluginApps[b.pluginName]?this.__pluginApps[b.pluginName]:(b.isPlugin=!0,this.__pluginApps[b.pluginName]=a(b),this.__pluginApps[b.pluginName])}};if("undefined"!=typeof window.onpopstate&&window.addEventListener("popstate",function(a){if(j.__mainAppInit){var b=j.__mainApp;b.state.spa&&e(b.state.curUrl).beforeHash()!=e(location.href).beforeHash()&&b.go(location.href,"replace")}},!1),document.addEventListener("click",function(a){function b(a){if(a!=document.body&&null!=a)if("A"==a.nodeName){if("undefined"!=typeof a.attributes.href){var e=a.attributes.href.value;c(e),d(e)}}else b(a.parentNode)}function c(b){"#"!=b.substr(0,1)&&(e(location.href).href==e(b).href?f(b):e(location.href).beforeHash()==e(b).beforeHash()?""==e(b).hash&&(a.preventDefault(),console.log("为了防止浏览器默认的刷新处理")):e(location.href).origin()==e(b).origin()&&f(b))}function d(a){var b=e(a).hash;if(""!=e(a).hash){var c=b.split("/");c.length>1&&"undefined"!=typeof j.__pluginApps[c[1]]&&j.__pluginApps[c[1]].go(a,"replace")}}function f(b){a.preventDefault(),console.info("开始解析:"+b),j.__mainApp.go(b,"push")}j.__mainAppInit?j.__mainApp.conf.spa&&b(a.target):j.__hasPlugins&&b(a.target)},!1),"object"==typeof exports&&"undefined"!=typeof module)module.exports=j;else if("function"==typeof define&&define.amd)define(function(){return j});else{var k;k="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,k.pansy=j}}(),pansy.Controller=function(){var a={};return function(b,c){var d="undefined"!=typeof a[b];return"function"==typeof c?(d&&console.warn("controller has exits, but this new controller will be registered: "+b),a[b]=c):d||(console.warn("controller lost fn param, but it still run: "+b),a[b]=function(a,b,c){c()}),a[b]}},pansy.Router=function(){var a=[];return{__stack:a,use:function(b){a.push(b)},route:function(b){return{get:function(){var c=Array.prototype.slice.call(arguments,0);map(c,function(c,d){a.push([b,c])})}}}}},pansy.createClass=function(){},pansy.render=function(){};var win=window,doc=document,head=doc.head,devnull=function(){},bundleIdCache={},bundleResultCache={},bundleCallbackQueue={};loadjs.ready=function(a,b,c){return subscribe(a,function(a){a.length?(c||devnull)(a):(b||devnull)()}),loadjs},loadjs.done=function(a){publish(a,[])},win.loadjs=loadjs,win.require=function(a){return bundleResultCache[a]},win.require.middleware=function(){var a=Array.prototype.slice.call(arguments,0);return function(b,c,d){loadjs(a,function(){d()},function(a){d(a)})}};