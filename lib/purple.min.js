/*! PURPLE.js v0.4.5 2015-05-15 */
!function(a){function b(a,b){function c(a){function b(a){var b=h.apps[a]={name:a,middleware:[],list:{},conf:{},currentHref:null,prevHref:null,set:function(a,b){this.conf[a]=b},get:function(a){return this.conf[a]},use:function(a){b.middleware.push(a)},go:function(a){function c(a){console.log(b.list);for(var c=b.list.length,d=0;c>d;d++)if(b.list[d].regexp.test(a))return b.list[d];return null}function d(){g._end||(f.length>0?f.shift()(g,h,d):h.end())}var e=c(a);if(null==e)return void console.log("无法解析的地址："+a);var f=b.middleware.concat(e.fns),g={_end:!1,query:{},rawUrl:"",paths:[]},h={end:function(){g._end=!0}};d()},back:function(){},route:function(a){if(e(a))var c=new RegExp("/"+a.join("/")+"/");else if(d(a))var c=new RegExp("/"+a+"/");else{if(!f(a))return!1;var c=a}var g=b.list[c]={regexp:c,get:function(){var a=Array.call(null,arguments);g.fns=a}};return g}};return b}return 0===arguments.length?null!==h.conf.mainApp?h.apps[h.conf.mainApp]:h.apps.__anonymous:"undefined"!=typeof h.apps[a]?h.apps[a]:b(a)}function d(a){return"string"==typeof a}function e(a){return a instanceof Array}function f(a){return a instanceof RegExp}function g(a){function b(a){return a.parentNode||a.parentElement}function c(a){return/state[a-z]+/.test(a)}var d=b(a);if("HTML"==d.nodeName)return!1;var e=d.id;return""!=e&&c(e)?e.substring(5):g(d)}var h={template:{},dom:{},apps:{__anonymous:{}},conf:{mainApp:null,scope:"/"}};return c.set=function(a,b){h.conf[a]=b},c.get=function(a){return h.conf[a]},c.start=function(){function a(a){var b=(a.target,$a.attr("href")||0),c=$a.attr("target")||0;if(0!=b&&0==c){var d=parseURL(b);if(h.scope.test(d.href)){var e=g($a[0]);0!=e&&(a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,routerHandle({machine:e,transport:d,type:"push",clearCache:!1}))}}}console.log(c()),console.log("系统启动..."),console.log("正在加载初始页..."),c().go(location.href),console.log("初始页加载成功..."),console.log("正在监听URL变化...");for(var b=document.scripts,d=0;d<b.length;d++){var e=document.scripts[d];"text/template"===e.type&&(h.template[e.attributes.getNamedItem("data-name").value]=e.innerText)}window.onpopstate=function(){var a=location.href;c().go(a)},document.addEventListener("click",a,!1)},c.node=function(a,b){function c(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild}function d(a){return a.hide=function(){this.style.display="none"},a.show=function(){this.style.display="inherit"},a}if("undefined"!=typeof stringDom)var e=h.node[nodename]=c(h.template[b]);else var e=h.node[nodename];return d(e)},c.debug=function(){return h},c}"function"==typeof define&&define.amd?define(["jquery"],function(c){return b(a,c)}):a.purple=b(a,jQuery)}(this);