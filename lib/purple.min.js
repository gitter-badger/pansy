/*! PURPLE.js v0.4.5 2015-05-15 */
!function(a){function b(a){function b(a){function b(a){var b=p.app[a]={name:a,middleware:[],list:{},conf:{},currentHref:null,prevHref:null,set:function(a,b){this.conf[a]=b},get:function(a){return this.conf[a]},use:function(a){b.middleware.push(a)},go:function(a,c){function d(a,c,d){console.log("正在解析地址："+a.rawUrl),console.log(b.list);for(key in b.list)if(b.list[key].regexp.test(a.pathname))return console.log("解析路由成功："+b.list[key].regexp),"replace"==a.historyStateType?history.replaceState("data","title",a.parsedURL):history.pushState("data","title",a.parsedURL),h=h.concat(b.list[key].fns),d();console.warn("无法解析的地址："+a.pathname),c.end()}function e(){f._end||(h.length>0?h.shift()(f,g,e):g.end())}var f=o(a);f._end=!1,f.rawUrl=a,f.historyStateType=c||"push";var g={end:function(){f._end=!0}},h=[d].concat(b.middleware);e()},back:function(){},route:function(a){if(g(a))var c=new RegExp("^/"+a.join("/")+"/$");else if(f(a))var c=new RegExp("^"+a+"$");else{if(!h(a))return!1;var c=a}var d=b.list[c]={regexp:c,get:function(){var a=Array.prototype.slice.call(arguments,0);d.fns=a[0]}};return d},render:function(a,b){c(document.body,a,b)}};return b}return 0===arguments.length?null!==p.conf.mainApp?p.app[p.conf.mainApp]:p.app.__anonymous:d(p.app[a])?p.app[a]:b(a)}function c(a,c,d){function f(a,c){for(var d=n(a),f=n(c),g={show:[],hide:[]},h=0;h<d.length;h++)console.log(d[h],f),k(d[h],f)||g.hide.push(d[h][d[h].length-1]);for(var h=0;h<f.length;h++){var i=f[h][f[h].length-1];if(g.show.push(i),e(p.node[i])){if(1==f[h].length)var j=document.body;else var l=f[h][f[h].length-2],j=p.node[l]||{aaa:"aaaa"};var m=j.querySelector('[data-id="'+i+'"]');null==m&&(m=j),m.appendChild(b.node(i,p.template[i]))}}return g}var g=p.tree||{},h=f(g,c);if(p.tree=c,"undefined"!=typeof d)d(h);else{for(var i=0;i<h.show.length;i++)b.node(h.show[i]).show();for(var i=0;i<h.hide.length;i++)b.node(h.hide[i]).hide()}}function d(a){return"undefined"!=typeof a}function e(a){return"undefined"==typeof a}function f(a){return"string"==typeof a}function g(a){return a instanceof Array}function h(a){return a instanceof RegExp}function j(a){var b=0;for(i in a)b++;return b}function k(a,b){for(var c=b.length,d=0;c>d;d++)if("object"==typeof b[d]){if(l(b[d],a))return!0}else if(b[d]==a)return!0;return!1}function l(a,b){if(a.length!=b.length)return!1;for(var c=b.length,d=0;c>d;d++)if(a[d]!==b[d])return!1;return!0}function m(a,b){for(var c=0;c<a.length;c++)a[c]==b&&(a.splice(c,1),c--);return a}function n(a){function b(a,d){Object.keys(a).forEach(function(e){var f=[];a[e]instanceof Object&&(d.length&&(f=d.concat()),f.push(e),c.push(f),b(a[e],f))})}var c=[];return b(a,[]),c}function o(a){var b=document.createElement("a");b.href=a;var c=b.pathname||"/"+b.pathname,d={href:b.href,origin:b.origin,source:a,protocol:b.protocol.replace(":",""),hostname:b.hostname,port:b.port,relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],pathname:c.replace(/^([^\/])/,"/$1"),pathnames:m(b.pathname.replace(/^\//,"").split("/"),""),search:b.search,searches:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}(),hash:b.hash.replace("#",""),hashes:m(b.hash.replace(/^(#)*/i,"").replace(/^\//,"").split("/"),""),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1]},e=String();if(e+="/"+d.pathnames.join("/"),j(d.searches)>0){e+=String("?");for(x in d.searches)e+=x+"=",e+="undefined"!=typeof d.searches[x]?d.searches[x]:"",e+="&";e=e.substring(0,e.length-1)}if(d.hashes.length>0){e+="#";for(var f=0;f<d.hashes.length;f++)e+=f<d.hashes.length-1?d.hashes[f]+String("/"):d.hashes[f]}return d.parsedURL=e,d}var p={tree:{},template:{},node:{},app:{__anonymous:{}},conf:{mainApp:null,scope:"/"}};return b.set=function(a,b){p.conf[a]=b},b.get=function(a){return p.conf[a]},b.start=function(){function a(){var a=location.href;b().go(a,"replace")}function c(a){function c(a){function b(a){null==a?c=null:"A"==a.nodeName?c=a.href||null:b(a.parentNode)}var c;return b(a),c}var d=c(a.target);null!==d&&(a.preventDefault(),b().go(d))}document.onreadystatechange=function(){if("complete"==document.readyState){for(var d=document.scripts,e=0;e<d.length;e++){var f=document.scripts[e];"text/template"===f.type&&(p.template[f.attributes.getNamedItem("data-name").value]=f.innerText)}console.log("系统启动成功..."),b().go(location.href),console.log("初始页加载成功..."),window.addEventListener("popstate",a,!1),console.log("正在监听URL变化..."),document.addEventListener("click",c,!1),console.log("正在监听链接点击...")}}},b.node=function(a,b){function c(a){var b=document.createElement("div");return b.innerHTML=a,f(b),b.firstChild}function e(a){return a.hide=function(){a.style.display="none"},a.show=function(){a.style.display="inherit"},a}function f(a){function b(a){if(a.childNodes.length>0)for(var b=a.childNodes.length-1;b>-1;b--)"#text"!=a.childNodes[b].nodeName||a.childNodes[b].remove()}return b(a),a}if(d(b))var g=p.node[a]=c(b);else var g=p.node[a]||document.createElement("div");return e(g)},b.debug=function(){return p},b}"function"==typeof define&&define.amd?define(function(){return b(a)}):a.purple=b(a)}(this);