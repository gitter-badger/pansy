/*! PURPLE.js v0.6.0-SNAPSHOT 2015-06-12 */
!function(a){function b(a){function b(a){return"function"==typeof a?(m.debug=a,!1):0===arguments.length?null!==m.conf.mainApp?m.app[m.conf.mainApp]:m.app.__anonymous:g(m.app[a])?m.app[a]:c(a)}function c(a){var b=m.app[a]={name:a,middleware:[],list:{},conf:{filter:"/",timeout:45e3,onpopstate:!1,onanchorclick:!1},state:"complete",currentHref:null,prevHref:null,listen:function(){},set:function(a,b){function c(a){f.go(location.href)}function e(a){f.go(d(event))}var f=this;"onpopstate"==a&&(f.conf.onpopstate&&!b&&window.removeEventListener("popstate",c,!1),!f.conf.onpopstate&&b&&window.addEventListener("popstate",c,!1)),"onanchorclick"==a&&(f.conf.onanchorclick&&!b&&document.removeEventListener("click",e,!1),!f.conf.onanchorclick&&b&&document.addEventListener("click",e,!1)),f.conf[a]=b},get:function(a){return this.conf[a]},use:function(a){b.middleware.push(a)},route:function(a){var c;if(i(a))c=new RegExp("^/"+a.join("/")+"/$");else if(h(a))c=new RegExp("^"+a+"$");else{if(!j(a))return!1;c=a}var d=b.list[c]={regexp:c,get:function(){d.fns=Array.prototype.slice.call(arguments,0)}};return d},go:function(a,c){function d(a){i._end||(k.length>0?k.shift()(i,j,d):j.end())}function g(a,c,d){"replace"==a.historyStateType?history.replaceState("data","title",a.parsedURL):history.pushState("data","title",a.parsedURL),f(null,"正在解析地址："+a.rawUrl);for(var e in b.list)if(b.list.hasOwnProperty(e)&&b.list[e].regexp.test(a.pathname))return f(null,"解析路由成功："+b.list[e].regexp),k=k.concat(b.list[e].fns),d();return new RegExp(a.app.conf.filter).test(a.pathname)?(f(null,"该地址无法解析："+a.pathname),void c.end()):location.replace(a.rawUrl)}var h=this;if("pending"==h.state)return!1;h.state="pending";var i=l(e(a),{_end:!1,rawUrl:a,historyStateType:c||"push"}),j={timestamp:Date.now(),prevView:null,end:function(){h.state="complete",i._end=!0,null!=this.prevView&&this.prevView.remove(),f(null,"路由跳转完毕...")}},k=[g].concat(b.middleware);d(),m.startable||(m.startable=!0,readyStart())},back:function(){history.back()}};return b}function d(a){function b(a){null==a?c=null:"A"==a.nodeName?c=a.href||null:b(a.parentNode)}var c=null;return b(a.target),null!==c&&a.preventDefault(),c}function e(a){var b=document.createElement("a");b.href=a;var c=b.pathname||"/"+b.pathname,d={rawUrl:b.href,href:b.href,origin:b.origin,source:a,protocol:b.protocol.replace(":",""),hostname:b.hostname,port:b.port,relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],pathname:c.replace(/^([^\/])/,"/$1"),pathnames:arrayClean(b.pathname.replace(/^\//,"").split("/"),""),search:b.search,searches:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}(),hash:b.hash.replace("#",""),hashes:arrayClean(b.hash.replace(/^(#)*/i,"").replace(/^\//,"").split("/"),""),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1]},e=String();if(e+="/"+d.pathnames.join("/"),!k(d.searches)){e+=String("?");for(var f in d.searches)d.searches.hasOwnProperty(f)&&(e+=f+"=",e+="undefined"!=typeof d.searches[f]?d.searches[f]:"",e+="&");e=e.substring(0,e.length-1)}if(d.hashes.length>0){e+="#";for(var g=0;g<d.hashes.length;g++)e+=g<d.hashes.length-1?d.hashes[g]+String("/"):d.hashes[g]}return d.parsedURL=e,d}function f(a,b){null==m.debug?a?console.error(a,b):console.log(b):m.debug(a,b)}function g(a){return"undefined"!=typeof a}function h(a){return"string"==typeof a}function i(a){return a instanceof Array}function j(a){return a instanceof RegExp}function k(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function l(){var a={},b=Array.prototype.slice.call(arguments,0);return b.forEach(function(b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}var m={debug:null,app:{__anonymous:{}},mainApp:null,startable:!1,startup:[]};return b}"function"==typeof define&&define.amd?define(function(){return b(a)}):a.purple=b(a)}(this);