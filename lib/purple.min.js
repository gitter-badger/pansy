/*! PURPLE.js v0.4.5 2015-05-19 */
!function(a){function b(a){function b(a){function b(a){var b=n.app[a]={name:a,middleware:[],list:{},conf:{},currentHref:null,prevHref:null,set:function(a,b){this.conf[a]=b},get:function(a){return this.conf[a]},use:function(a){b.middleware.push(a)},go:function(a,d){function e(a,c,d){console.log("正在解析地址："+a.rawUrl);for(key in b.list)if(b.list[key].regexp.test(a.pathname))return console.log("解析路由成功："+b.list[key].regexp),"replace"==a.historyStateType?history.replaceState("data","title",a.parsedURL):history.pushState("data","title",a.parsedURL),i=i.concat(b.list[key].fns),d();console.warn("无法解析的地址："+a.pathname),c.end()}function f(){g._end||(i.length>0?i.shift()(g,h,f):h.end())}var g=m(a);g._end=!1,g.rawUrl=a,g.historyStateType=d||"push";var h={timestamp:Date.now(),prevView:null,end:function(){g._end=!0,null!=this.prevView&&this.prevView.remove(),console.log("路由跳转完毕...")},render:function(a,b){c(this,a,b)}},i=[e].concat(b.middleware);f()},back:function(){history.back()},route:function(a){if(g(a))var c=new RegExp("^/"+a.join("/")+"/$");else if(f(a))var c=new RegExp("^"+a+"$");else{if(!h(a))return!1;var c=a}var d=b.list[c]={regexp:c,get:function(){d.fns=Array.prototype.slice.call(arguments,0)}};return d}};return b}return 0===arguments.length?null!==n.conf.mainApp?n.app[n.conf.mainApp]:n.app.__anonymous:d(n.app[a])?n.app[a]:b(a)}function c(a,c,f){if(null==a.prevView){a.prevView=b.node("prevView",'<div id="prevView"></div>');for(var g=b.scope().childNodes.length-1;g>-1;g--)a.prevView.appendChild(b.scope().childNodes[g]);b.scope().appendChild(a.prevView),n.node={}}for(var h=l(c),g=0;g<h.length;g++){var i=h[g][h[g].length-1];if(null==b.node(i)){var j=b.node(i,n.template[i]);if(1==h[g].length)var k=b.scope();else var m=h[g][h[g].length-2],k=b.node(m);var o=k.querySelector('[data-id="'+i+'"]');null==o&&(o=k),o.appendChild(j),e(f)&&(j.style.display=null)}}d(f)&&f(prevView,b.scope())}function d(a){return"undefined"!=typeof a}function e(a){return"undefined"==typeof a}function f(a){return"string"==typeof a}function g(a){return a instanceof Array}function h(a){return a instanceof RegExp}function j(a){var b=0;for(i in a)b++;return b}function k(a,b){for(var c=0;c<a.length;c++)a[c]==b&&(a.splice(c,1),c--);return a}function l(a){function b(a,d){Object.keys(a).forEach(function(e){var f=[];a[e]instanceof Object&&(d.length&&(f=d.concat()),f.push(e),c.push(f),b(a[e],f))})}var c=[];return b(a,[]),c}function m(a){var b=document.createElement("a");b.href=a;var c=b.pathname||"/"+b.pathname,d={href:b.href,origin:b.origin,source:a,protocol:b.protocol.replace(":",""),hostname:b.hostname,port:b.port,relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],pathname:c.replace(/^([^\/])/,"/$1"),pathnames:k(b.pathname.replace(/^\//,"").split("/"),""),search:b.search,searches:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}(),hash:b.hash.replace("#",""),hashes:k(b.hash.replace(/^(#)*/i,"").replace(/^\//,"").split("/"),""),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1]},e=String();if(e+="/"+d.pathnames.join("/"),j(d.searches)>0){e+=String("?");for(x in d.searches)e+=x+"=",e+="undefined"!=typeof d.searches[x]?d.searches[x]:"",e+="&";e=e.substring(0,e.length-1)}if(d.hashes.length>0){e+="#";for(var f=0;f<d.hashes.length;f++)e+=f<d.hashes.length-1?d.hashes[f]+String("/"):d.hashes[f]}return d.parsedURL=e,d}var n={tree:{},template:{},node:{},app:{__anonymous:{}},conf:{mainApp:null,scope:document.body,filter:"/"}};return b.template=function(a){return n.template[a]||"<div></div>"},b.set=function(a,b){n.conf[a]=b},b.get=function(a){return n.conf[a]},b.scope=function(){return n.conf.scope},b.start=function(){function a(){var a=location.href;b().go(a,"replace")}function c(a){function c(a){function b(a){null==a?c=null:"A"==a.nodeName?c=a.href||null:b(a.parentNode)}var c;return b(a),c}var d=c(a.target);null!==d&&(a.preventDefault(),b().go(d))}for(var d=document.scripts.length,e=d-1;e>-1;e--){var f=document.scripts[e];"text/template"===f.type&&(n.template[f.attributes.getNamedItem("data-name").value]=f.innerText,f.remove())}console.log("系统启动成功..."),b().go(location.href),console.log("初始页加载成功..."),window.addEventListener("popstate",a,!1),console.log("正在监听URL变化..."),document.addEventListener("click",c,!1),console.log("正在监听链接点击...")},b.node=function(a,b){function c(a){var b=document.createElement("div");return b.innerHTML=a,e(b),b.firstChild}function e(a){function b(a){if(a.childNodes.length>0)for(var b=a.childNodes.length-1;b>-1;b--)"#text"!=a.childNodes[b].nodeName||a.childNodes[b].remove()}return b(a),a}if(d(b)){var f=n.node[a]=c(b);f.style.display="none"}else var f=n.node[a]||null;return f},b.debug=function(){return n},b.dom=function(a){if("undefined"!=typeof a.__enhanced)return a;var b=a.style.transform||a.style["-webkit-transform"]||a.style["-moz-transform"],c={x:0,y:0,z:0},d={x:1,y:1},e={x:0,y:0,z:0,angle:0};if(null!=b&&""!=b){b=b.toLowerCase();var f=b.match(/(?:translate3d).+?\)/);if(null!=f){var g=f[0].split(/translate3d/)[1].match(/\d+/g);c={x:Number(g[0]),y:Number(g[1]),z:Number(g[2])}}var h=b.match(/(?:scale).+?\)/);if(null!=h){var i=h[0].split(/scale/)[1].match(/\d+/g);d={x:Number(i[0]),y:Number(i[1])}}var j=b.match(/(?:rotate3d).+?\)/);if(null!=j){var k=j[0].split(/rotate3d/)[1].match(/\d+/g);e={x:Number(k[0]),y:Number(k[1]),z:Number(k[2]),angle:Number(k[3])}}}return a.__transform={translate3d:c,scale:d,rotate3d:e},a.transform=function(a){var b=["translate3d("+a.translate3d.x+"px, "+a.translate3d.y+"px, 0)","scale("+a.scale.x+", "+a.scale.y+")","rotate3d("+a.rotate3d.x+","+a.rotate3d.y+","+a.rotate3d.z+","+a.rotate3d.angle+"deg)"];return b=b.join(" "),this.style.webkitTransform=b,this.style.mozTransform=b,this.style.transform=b,this.__transform=a,this.__transform.prev={translate3d:JSON.parse(JSON.stringify(this.__transform.translate3d)),scale:JSON.parse(JSON.stringify(this.__transform.scale)),rotate3d:JSON.parse(JSON.stringify(this.__transform.rotate3d))},this},a.__enhanced=!0,a},b}"function"==typeof define&&define.amd?define(function(){return b(a)}):a.purple=b(a)}(this);