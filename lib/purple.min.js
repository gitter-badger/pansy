/*! PURPLE.js v0.4.5 2015-05-15 */
!function(a){function b(a,b){function c(a){function b(a){var b=r.apps[a]={name:a,middleware:[],list:{},conf:{},currentHref:null,prevHref:null,set:function(a,b){this.conf[a]=b},get:function(a){return this.conf[a]},use:function(a){b.middleware.push(a)},go:function(a){function c(a,c,d){console.log("正在解析地址："+a.rawUrl),console.log(b.list);for(key in b.list)if(b.list[key].regexp.test(a.pathname))return console.log("解析路由成功："+b.list[key].regexp),g=g.concat(b.list[key].fns),d();console.warn("无法解析的地址："+a.pathname),c.end()}function d(){e._end||(g.length>0?g.shift()(e,f,d):f.end())}var e=q(a);e._end=!1,e.rawUrl=a;var f={end:function(){e._end=!0}},g=[c].concat(b.middleware);d()},back:function(){},route:function(a){if(h(a))var c=new RegExp("^/"+a.join("/")+"/$");else if(g(a))var c=new RegExp("^"+a+"$");else{if(!j(a))return!1;var c=a}var d=b.list[c]={regexp:c,get:function(){var a=Array.prototype.slice.call(arguments,0);d.fns=a[0]}};return d},render:function(a,b){d(document.body,a,b)}};return b}return 0===arguments.length?null!==r.conf.mainApp?r.apps[r.conf.mainApp]:r.apps.__anonymous:"undefined"!=typeof r.apps[a]?r.apps[a]:b(a)}function d(a,b,d){function e(a,b){for(var d=o(a),e=o(b),g={show:[],hide:[]},h=0;h<d.length;h++)l(d[h],e)||g.hide.push(d[h][d[h].length-1]);for(var h=0;h<e.length;h++){var i=e[h][e[h].length-1];if(g.show.push(i),f(r.node[i])){if(1==e[h].length)var j=document.body;else var k=e[h][e[h].length-2],j=r.node[k]||{aaa:"aaaa"};var m=j.querySelector('[data-id="'+i+'"]');null==m&&(m=j),m.appendChild(c.node(i,i))}}return g}var g=r.currentPurpleTemplateStructure||{},h=e(g,b);if("undefined"!=typeof d)d(h);else{for(var i=0;i<h.show.length;i++)c.node(h.show[i]).show();for(var i=0;i<h.hide.length;i++)c.node(h.hide[i]).hide()}}function e(a){return"undefined"!=typeof a}function f(a){return"undefined"==typeof a}function g(a){return"string"==typeof a}function h(a){return a instanceof Array}function j(a){return a instanceof RegExp}function k(a){var b=0;for(i in a)b++;return b}function l(a,b){for(var c=b.length,d=0;c>d;d++)if("object"==typeof b[d]){if(m(b[d],a))return!0}else if(b[d]==a)return!0;return!1}function m(a,b){if(a.length!=b.length)return!1;for(var c=b.length,d=0;c>d;d++)if(a[d]!==b[d])return!1;return!0}function n(a,b){for(var c=0;c<a.length;c++)a[c]==b&&(a.splice(c,1),c--);return a}function o(a){function b(a,d){Object.keys(a).forEach(function(e){var f=[];a[e]instanceof Object&&(d.length&&(f=d.concat()),f.push(e),c.push(f),b(a[e],f))})}var c=[];return b(a,[]),c}function p(a){function b(a){return a.parentNode||a.parentElement}function c(a){return/state[a-z]+/.test(a)}var d=b(a);if("HTML"==d.nodeName)return!1;var e=d.id;return""!=e&&c(e)?e.substring(5):p(d)}function q(a){var b=document.createElement("a");b.href=a;var c=b.pathname||"/"+b.pathname,d={href:b.href,origin:b.origin,source:a,protocol:b.protocol.replace(":",""),hostname:b.hostname,port:b.port,relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],pathname:c.replace(/^([^\/])/,"/$1"),pathnames:n(b.pathname.replace(/^\//,"").split("/"),""),search:b.search,searches:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}(),hash:b.hash.replace("#",""),hashes:n(b.hash.replace(/^(#)*/i,"").replace(/^\//,"").split("/"),""),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1]},e=String();if(e+="/"+d.pathnames.join("/"),k(d.searches)>0){e+=String("?");for(x in d.searches)e+=x+"=",e+="undefined"!=typeof d.searches[x]?d.searches[x]:"",e+="&";e=e.substring(0,e.length-1)}if(d.hashes.length>0){e+="#";for(var f=0;f<d.hashes.length;f++)e+=f<d.hashes.length-1?d.hashes[f]+String("/"):d.hashes[f]}return d.parsedURL=e,d}var r={template:{},node:{},apps:{__anonymous:{}},conf:{mainApp:null,scope:"/"}};return c.set=function(a,b){r.conf[a]=b},c.get=function(a){return r.conf[a]},c.start=function(){function a(a){var b=(a.target,$a.attr("href")||0),c=$a.attr("target")||0;if(0!=b&&0==c){var d=q(b);if(r.scope.test(d.href)){var e=p($a[0]);0!=e&&(a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,routerHandle({machine:e,transport:d,type:"push",clearCache:!1}))}}}document.onreadystatechange=function(){if("complete"==document.readyState){for(var b=document.scripts,d=0;d<b.length;d++){var e=document.scripts[d];"text/template"===e.type&&(r.template[e.attributes.getNamedItem("data-name").value]=e.innerText)}window.onpopstate=function(){var a=location.href;c().go(a)},document.addEventListener("click",a,!1),console.log("系统启动..."),console.log("正在加载初始页..."),c().go(location.href),console.log("初始页加载成功..."),console.log("正在监听URL变化...")}}},c.node=function(a,b){function c(a){var b=document.createElement("div");return b.innerHTML=a,f(b),b.firstChild}function d(a){return a.hide=function(){a.style.display="none"},a.show=function(){a.style.display="inherit"},a}function f(a){function b(a){if(a.childNodes.length>0)for(var b=a.childNodes.length-1;b>-1;b--)"#text"!=a.childNodes[b].nodeName||a.childNodes[b].remove()}return b(a),a}if(e(b))var g=r.node[a]=c(r.template[b]);else var g=r.node[a]||document.createElement("div");return d(g)},c.debug=function(){return r},c}"function"==typeof define&&define.amd?define(["jquery"],function(c){return b(a,c)}):a.purple=b(a,jQuery)}(this);