/*! pansy.js v0.7.18 UTC:2016-02-24 02:54:02 */
!function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.pansy=a():b.pansy=a()}(this,function(){return function(c){function a(d){if(b[d])return b[d].exports;var e=b[d]={exports:{},id:d,loaded:!1};return c[d].call(e.exports,e,e.exports,a),e.loaded=!0,e.exports}var b={};return a.m=c,a.c=b,a.p="",a(0)}([function(n,o,m){function k(){return a.__hasInit?!1:(a.__hasInit=!0,"undefined"!=typeof window.onpopstate&&window.addEventListener("popstate",j,!1),void("undefined"!=typeof document.addEventListener?document.addEventListener("click",c,!1):"undefined"!=typeof document.attachEvent?document.attachEvent("onclick",c):document.onclick=c))}function j(d){if(a.__mainAppInit){var c=a.__mainApp;c.state.spa&&b(c.state.curUrl).beforeHash()!=b(location.href).beforeHash()&&c.go(location.href,"replace")}}function c(c){function d(a){if(a!=document.body&&null!=a)if("A"==a.nodeName){if("undefined"!=typeof a.attributes.href){var b=a.attributes.href.value;f(b),g(b)}}else d(a.parentNode)}function f(a){"#"!=a.substr(0,1)&&(b(location.href).href==b(a).href?e(a):b(location.href).beforeHash()==b(a).beforeHash()?""==b(a).hash&&(c.preventDefault(),console.log("为了防止浏览器默认的刷新处理")):b(location.href).origin()==b(a).origin()&&e(a))}function g(d){var f=b(d).hash;if(""!=b(d).hash){var e=f.split("/");e.length>1&&"undefined"!=typeof a.__pluginApps[e[1]]&&(c.preventDefault(),a.__pluginApps[e[1]].go(d,"replace"))}}function e(b){c.preventDefault(),console.info("开始解析:"+b),a.__mainApp.go(b,"push")}a.__mainAppInit?a.__mainApp.state.spa&&d(c.target):a.__hasPlugins&&d(c.target)}function g(c){var a={state:{isPlugin:!1,complete:!0,prevUrl:null,curUrl:location.href,timeout:6e4,mode:!1,routeQuery:null,routeScope:"",spa:!1,protocol:null},stack:[],set:function(a,b){var c=this;return"undefined"!=typeof b&&(c.state[a]=b),c.state[a].toString()||void 0},use:function(){var b=this;if(1==arguments.length)if("function"==typeof arguments[0]){var c={fn:arguments[0]};c.isErrorHandle=f(c.fn),b.stack.push(c)}else if(arguments[0]instanceof Array){var e=arguments[0];d(e,function(a,c){"function"==typeof a?b.use(a):a instanceof Array&&2==a.length?b.use(a[0],a[1]):(console.warn("use参数有误"),console.warn(a))})}else arguments[0]instanceof Object?arguments[0].__stack instanceof Array?b.use(arguments[0].__stack):console.warn("use router 时参数有误"):console.warn("use参数异常");else if(2==arguments.length){var a=arguments[0];a instanceof Array?a=new RegExp("(^"+a.join("$)|(^")+"$)"):"string"==typeof a&&(a=new RegExp("^"+a+"$")),!a instanceof RegExp&&console.error("route参数错误: "+a),b.stack.push({fn:arguments[1],path:a,isErrorHandel:f(arguments[1])})}},route:function(a){var b=this;return{get:function(){var c=Array.prototype.slice.call(arguments,0);d(c,function(c,d){b.use(a,c)})}}},go:function(j,o){function e(b){function f(){try{a.stack[d].fn(c,m,e)}catch(b){console.log(b),b&&e(b)}}return d++,d>=a.stack.length?(b&&console.error(b),c.routed||console.error("404 not found"),m.end()):b?a.stack[d].isErrorHandle?a.stack[d].fn(b,c,m,e):e(b):a.stack[d].isErrorHandle?e():"undefined"!=typeof a.stack[d].disabled?e():"undefined"!=typeof a.stack[d].path?i(c,a.stack[d].path)?(f(),c.routed=!0):e():void f()}k();var a=this;if(!a.state.complete)return!1;a.state.complete=!1;var f=b(j||location.href).all(),g="/";a.state.isPlugin?j.length>0&&j.match(new RegExp("^#/"+a.state.pluginName))&&(g=j.substring(a.state.pluginName.length+2)||"/"):a.state.routeQuery?g=f.query[a.state.routeQuery]||"/":(f.pathname.match(new RegExp("^"+a.state.routeScope))&&(g=f.pathname.substr(a.state.routeScope.length)||"/"),f.params=l(g.replace(/^\//,"").split("/"),"")),f.filterPath=g,console.info("请求地址: "+f.filterPath);var c=h(f,{routed:!1,expire:(new Date).getTime()+a.state.timeout,conf:a.state,state:a.state,historyStateType:"push"}),m={end:function(){n=!0,a.state.complete=!0,a.state.errorStack=null,console.info("请求结束"),a.state.spa&&"file:"!=a.state.protocol&&("replace"==c.historyStateType?(console.info("spa: true, history replace "+c.rawUrl),history.replaceState("data","title",c.rawUrl)):(console.info("spa: true, history push "+c.rawUrl),history.pushState("data","title",c.rawUrl)))},redirect:function(b){m.end(),a.state.spa?a.go(a.state.routeScope):location.href=a.state.routeScope+b}},n=!1,d=-1;e()}};return a.state=h(a.state,c),a}function f(a){try{return 4==a.toString().match(/[A-Z0-9a-z,(\s]*\)/)[0].split(",").length}catch(b){return!1}}function i(a,b){try{return a.filterPath.match(b)[0]==a.filterPath}catch(c){return!1}}function d(a,c){var d={};for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&"function"==typeof c&&(d[b]=c.call(a,a[b],b,a));return d}function e(b,c){var d=b.length;if("function"!=typeof c)throw new TypeError;for(var a=0;d>a;a++)a in b&&c.call(arguments[1],b[a],a,b)}function h(){var a={},b=Array.prototype.slice.call(arguments,0);return e(b,function(b,d){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}),a}function l(b,c){var a=[];return e(b,function(b){b!==c&&a.push(b)}),a}var b=m(1),a=n.exports={__hasInit:!1,__mainAppInit:!1,__hasPlugins:!1,__mainApp:{},__pluginApps:{},__onpopstate:!1,__onanchorclick:!1,createMain:function(b){return this.__mainAppInit?this.__mainApp:(a.__mainAppInit=!0,this.__mainApp=g(b))},createPlugin:function(b){return a.__hasPlugins=!0,"undefined"!=typeof this.__pluginApps[b.pluginName]?this.__pluginApps[b.pluginName]:(b.isPlugin=!0,this.__pluginApps[b.pluginName]=g(b),this.__pluginApps[b.pluginName])},createRouter:function(){var a=[];return{__stack:a,use:function(b){a.push(b)},route:function(b){return{get:function(){var c=Array.prototype.slice.call(arguments,0);d(c,function(c,d){a.push([b,c])})}}}}}};a.Plugin=a.createPlugin,a.Main=a.createMain,a.Master=a.createMain,a.Router=a.createRouter},function(a,b){a.exports=function(e){function f(){return a.href.replace(/#.*/,"")}function b(){var b=a.pathname||"/"+a.pathname;return b.replace(/^([^\/])/,"/$1")}function c(){for(var d={},c=a.search.replace(/^\?/,"").split("&"),f=c.length,b=0;f>b;b++)if(c[b]){var e=c[b].split("=");d[e[0]]=e[1]}return d}function d(){if("undefined"!=typeof a.origin)return a.origin;var b=a.protocol+"//"+a.hostname;return""==a.port?b:"80"==a.port&&"http:"==a.protocol?b:"443"==a.port&&"https"==a.protocol?b:b+=":"+a.port}var a=document.createElement("a");return a.href=e,{rawUrl:a.href,href:a.href,hash:a.hash,port:a.port,protocol:a.protocol,pathname:b,query:c,origin:d,beforeHash:f,all:function(){return{rawUrl:a.href,port:a.port,protocol:a.protocol,hostname:a.hostname,pathname:b(),query:c(),origin:d()}}}}}])});