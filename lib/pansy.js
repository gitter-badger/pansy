/*! pansy.js v0.7.24 UTC:2016-03-01 03:47:01 */
!function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.pansy=a():b.pansy=a()}(this,function(){return function(c){function a(d){if(b[d])return b[d].exports;var e=b[d]={exports:{},id:d,loaded:!1};return c[d].call(e.exports,e,e.exports,a),e.loaded=!0,e.exports}var b={};return a.m=c,a.c=b,a.p="",a(0)}([function(g,j,c){function e(){return a.__hasInit?!1:(a.__hasInit=!0,"undefined"!=typeof window.onpopstate&&window.addEventListener("popstate",h,!1),void("undefined"!=typeof document.addEventListener?document.addEventListener("click",d,!1):"undefined"!=typeof document.attachEvent?document.attachEvent("onclick",d):document.onclick=d))}function h(d){if(a.__mainAppInit){var c=a.__mainApp;c.state.spa&&(console.log("popstateHandle handling...."),console.log(c.state.curUrl,location.href),b(c.state.curUrl).beforeHash()!=b(location.href).beforeHash()?(console.log("popstateHandle get right, and run app.go(location.href)"),c.go(location.href,"replace")):console.log("popstateHandle give up handle function"))}}function d(c){function d(a){if(a!=document.body&&null!=a)if("A"==a.nodeName){if("undefined"!=typeof a.attributes.href){var b=a.attributes.href.value;f(b),g(b)}}else d(a.parentNode)}function f(a){"#"!=a.substr(0,1)&&(b(location.href).href==b(a).href?e(a):b(location.href).beforeHash()==b(a).beforeHash()?""==b(a).hash&&(c.preventDefault(),console.log("为了防止浏览器默认的刷新处理")):b(location.href).origin()==b(a).origin()&&e(a))}function g(d){var f=b(d).hash;if(""!=b(d).hash){var e=f.split("/");e.length>1&&"undefined"!=typeof a.__pluginApps[e[1]]&&(c.preventDefault(),a.__pluginApps[e[1]].go(d,"replace"))}}function e(b){c.preventDefault(),console.info("开始解析:"+b),a.__mainApp.go(b,"push")}a.__mainAppInit?a.__mainApp.state.spa&&d(c.target):a.__hasPlugins&&d(c.target)}var b=c(1),i=c(2),f=c(4),a={__hasInit:!1,__mainAppInit:!1,__hasPlugins:!1,__mainApp:{},__pluginApps:{},__onpopstate:!1,__onanchorclick:!1,createMain:function(b){return e(),this.__mainAppInit?this.__mainApp:(a.__mainAppInit=!0,this.__mainApp=f(b))},createPlugin:function(a){return e(),this.__hasPlugins=!0,"undefined"!=typeof this.__pluginApps[a.pluginName]?this.__pluginApps[a.pluginName]:(a.isPlugin=!0,this.__pluginApps[a.pluginName]=f(a),this.__pluginApps[a.pluginName])}};a.Plugin=a.createPlugin,a.Main=a.createMain,a.Master=a.createMain,a.Router=a.Router=i,g.exports=a},function(a,c){function b(e){function f(){return a.href.replace(/#.*/,"")}function b(){var b=a.pathname||"/"+a.pathname;return b.replace(/^([^\/])/,"/$1")}function c(){for(var d={},c=a.search.replace(/^\?/,"").split("&"),f=c.length,b=0;f>b;b++)if(c[b]){var e=c[b].split("=");d[e[0]]=e[1]}return d}function d(){if("undefined"!=typeof a.origin)return a.origin;var b=a.protocol+"//"+a.hostname;return""==a.port?b:"80"==a.port&&"http:"==a.protocol?b:"443"==a.port&&"https"==a.protocol?b:b+=":"+a.port}var a=document.createElement("a");return a.href=e,{rawUrl:a.href,href:a.href,hash:a.hash,port:a.port,protocol:a.protocol,pathname:b,query:c,origin:d,beforeHash:f,all:function(){return{rawUrl:a.href,port:a.port,protocol:a.protocol,hostname:a.hostname,pathname:b(),query:c(),origin:d()}}}}a.exports=b},function(a,e,b){function c(){var a=[];return{__stack:a,use:function(b){a.push(b)},route:function(b){return{get:function(){var c=Array.prototype.slice.call(arguments,0);d(c,function(c,d){a.push([b,c])})}}}}}var d=b(3);a.exports=c},function(a,c){function b(a,c){var d={};for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&"function"==typeof c&&(d[b]=c.call(a,a[b],b,a));return d}a.exports=b},function(e,j,a){function f(e){var a={state:{isPlugin:!1,complete:!0,prevUrl:null,curUrl:location.href,timeout:6e4,mode:!1,routeQuery:null,routeScope:"",spa:!1,protocol:null},stack:[],set:function(a,b){var c=this;return"undefined"!=typeof b&&(c.state[a]=b),c.state[a].toString()||void 0},use:function(){var c=this;if(1==arguments.length)if("function"==typeof arguments[0]){var e={fn:arguments[0]};e.isErrorHandle=d(e.fn),c.stack.push(e)}else if(arguments[0]instanceof Array){var f=arguments[0];b(f,function(a,b){"function"==typeof a?c.use(a):a instanceof Array&&2==a.length?c.use(a[0],a[1]):(console.warn("use参数有误"),console.warn(a))})}else arguments[0]instanceof Object?arguments[0].__stack instanceof Array?c.use(arguments[0].__stack):console.warn("use router 时参数有误"):console.warn("use参数异常");else if(2==arguments.length){var a=arguments[0];a instanceof Array?a=new RegExp("(^"+a.join("$)|(^")+"$)"):"string"==typeof a&&(a=new RegExp("^"+a+"$")),!a instanceof RegExp&&console.error("route参数错误: "+a),c.stack.push({fn:arguments[1],path:a,isErrorHandel:d(arguments[1])})}},route:function(a){var c=this;return{get:function(){var d=Array.prototype.slice.call(arguments,0);b(d,function(b,d){c.use(a,b)})}}},go:function(k,m){function e(c){function f(){try{a.stack[d].fn(b,l,e)}catch(c){console.log(c),c&&e(c)}}return d++,d>=a.stack.length?(c&&console.error(c),b.routed||console.error("404 not found"),l.end()):c?a.stack[d].isErrorHandle?a.stack[d].fn(c,b,l,e):e(c):a.stack[d].isErrorHandle?e():"undefined"!=typeof a.stack[d].disabled?e():"undefined"!=typeof a.stack[d].path?g(b,a.stack[d].path)?(f(),b.routed=!0):e():void f()}var a=this;if(!a.state.complete)return!1;a.state.complete=!1;var f=i(k||location.href).all(),j="/";a.state.isPlugin?k.length>0&&k.match(new RegExp("^#/"+a.state.pluginName))&&(j=k.substring(a.state.pluginName.length+2)||"/"):a.state.routeQuery?j=f.query[a.state.routeQuery]||"/":(f.pathname.match(new RegExp("^"+a.state.routeScope))&&(j=f.pathname.substr(a.state.routeScope.length)||"/"),f.params=h(j.replace(/^\//,"").split("/"),"")),f.filterPath=j,console.info("请求地址: "+f.filterPath);var b=c(f,{routed:!1,expire:(new Date).getTime()+a.state.timeout,conf:a.state,state:a.state,locals:{},historyStateType:m||"push"}),l={end:function(){n=!0,a.state.complete=!0,a.state.errorStack=null,console.info("请求结束"),a.state.spa&&"file:"!=a.state.protocol&&("replace"==b.historyStateType?(console.info("spa: true, history replace "+b.rawUrl),history.replaceState("data","title",b.rawUrl)):(console.info("spa: true, history push "+b.rawUrl),history.pushState("data","title",b.rawUrl)))},redirect:function(b){l.end(),console.info("重定向到: "+b),a.state.spa?a.go(b,"replace"):location.href=b}},n=!1,d=-1;e()}};return a.state=c(a.state,e),a}var b=a(3),c=a(5),g=a(7),d=a(8),h=a(9),i=a(1);e.exports=f},function(a,e,b){function c(){var a={},b=Array.prototype.slice.call(arguments,0);return d(b,function(b,d){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}),a}var d=b(6);a.exports=c},function(a,c){function b(b,c){var d=b.length;if("function"!=typeof c)throw new TypeError;for(var a=0;d>a;a++)a in b&&c.call(arguments[1],b[a],a,b)}a.exports=b},function(a,c){function b(a,b){try{return a.filterPath.match(b)[0]==a.filterPath}catch(c){return!1}}a.exports=b},function(a,c){function b(a){try{return 4==a.toString().match(/[A-Z0-9a-z,(\s]*\)/)[0].split(",").length}catch(b){return!1}}a.exports=b},function(a,e,b){function c(b,c){var a=[];return d(b,function(b){b!==c&&a.push(b)}),a}var d=b(6);a.exports=c}])});